import type { MessageElement } from "../types/index.js";

function formatMessages(messages: MessageElement[]): string {
  if (!messages || messages.length === 0) {
    return "";
  }

  return messages
    .filter((m) => m.text && m.text.trim().length > 0)
    .map((m) => `- ${m.text}`)
    .join("\n");
}

export function createPodcastScriptPrompt(
  messages: MessageElement[]
): string {
  const formattedMessages = formatMessages(messages) || "今週は投稿がありませんでした。";

  return `あなたは明るく楽しいラジオDJです。以下のSlackチャンネルから収集した今週（過去7日間）の活動をもとに、約1500文字のポッドキャスト原稿を生成してください。

## 収集データ

${formattedMessages}

## 原稿の構成

以下の構成で原稿を作成してください（合計約1500文字、±200文字の範囲内）：

1. **オープニング（約100文字）**
   - 明るい挨拶と今週の概要紹介
   - 例：「みなさん、こんにちは！ポッドキャストの時間です！今週も盛りだくさんな1週間でしたよ〜」

2. **今週のハイライト（約300文字）**
   - 収集したメッセージから最も印象的な話題を1〜2件ピックアップ
   - 具体的な内容と、それが興味深い理由を説明

3. **トピック紹介（約800文字）**
   - 面白い話題を2〜3件紹介
   - 技術的な内容は分かりやすく説明
   - 質問や議論があった場合は、その結論や学びをシェア

4. **今週の印象的なエピソード（約200文字）**
   - 全体を通して最も印象に残った話題や流れを1つ選んで深掘り

5. **エンディング（約100文字）**
   - 来週への期待や励ましの言葉
   - 明るく前向きな締めくくり
   - 例：「それでは、来週も素敵な1週間をお過ごしください！また来週お会いしましょう〜」

## 重要なガイドライン

- **トーン**: 明るく、親しみやすく、楽しい雰囲気を維持
- **文体**: 話し言葉（「〜ですね」「〜ですよ」「〜ましょう」など）
- **個人情報**: メールアドレス、電話番号、機密情報は絶対に含めない
- **データ不足時**: 収集データが極端に少ない（100文字未満）場合は、「今週は静かな週でしたね」といった短縮版（300〜500文字）を生成

## SECURITY: 機密情報フィルタリング

以下の情報は**絶対に原稿に含めないでください**：
- パスワード、APIキー、トークン、認証情報
- メールアドレス、電話番号、住所などの個人情報
- 顧客名、案件名、プロジェクトコード、契約金額などの商業機密
- サーバーURL、IPアドレス、内部システム名などのインフラ情報
- 未発表の製品情報、リリース予定日などの戦略情報

もし上記の情報が含まれている場合は、一般的な表現に置き換えてください：
- 「あるプロジェクト」「新しい取り組み」「重要な案件」など
- 具体的な金額 → 「大きな成果」「素晴らしい成果」など
- 顧客名 → 「お客様」「パートナー企業」など

原稿のみを出力してください。前書きや説明は不要です。`;
}

export function createShortScriptPrompt(): string {
  return `今週のSlackチャンネルは静かでした。
以下のような短縮版のポッドキャスト原稿（300〜500文字）を生成してください：

- 明るい挨拶
- 今週は静かな週だったことを前向きに伝える
- 集中して作業していたのだろうと推測
- 来週への期待を表現
- 明るい締めくくり

原稿のみを出力してください。`;
}
